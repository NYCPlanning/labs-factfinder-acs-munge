library(readxl)
library(tidyr)
library(reshape2)
setwd("~/r-acs-munge")

Demographic1115_1 <- read_excel("~/r-acs-munge/Demographic1115_1.xlsx", 
                                skip = 3)


cols1 <- c("Pop_1E","Pop_1M","Pop_1C","Pop_1P","Pop_1Z","MaleE","MaleM","MaleC","MaleP","MaleZ","FemE","FemM","FemC","FemP","FemZ","PopU5E","PopU5M","PopU5C","PopU5P","PopU5Z","Pop5t9E","Pop5t9M","Pop5t9C","Pop5t9P","Pop5t9Z","Pop10t14E","Pop10t14M","Pop10t14C","Pop10t14P","Pop10t14Z","Pop15t19E","Pop15t19M","Pop15t19C","Pop15t19P","Pop15t19Z","Pop20t24E","Pop20t24M","Pop20t24C","Pop20t24P","Pop20t24Z","Pop25t29E","Pop25t29M","Pop25t29C","Pop25t29P","Pop25t29Z","Pop30t34E","Pop30t34M","Pop30t34C","Pop30t34P","Pop30t34Z","Pop35t39E","Pop35t39M","Pop35t39C","Pop35t39P","Pop35t39Z","Pop40t44E","Pop40t44M","Pop40t44C","Pop40t44P","Pop40t44Z","Pop45t49E","Pop45t49M","Pop45t49C","Pop45t49P","Pop45t49Z","Pop50t54E","Pop50t54M","Pop50t54C","Pop50t54P","Pop50t54Z","Pop55t59E","Pop55t59M","Pop55t59C","Pop55t59P","Pop55t59Z","Pop60t64E","Pop60t64M","Pop60t64C","Pop60t64P","Pop60t64Z","Pop65t69E","Pop65t69M","Pop65t69C","Pop65t69P","Pop65t69Z","Pop70t74E","Pop70t74M","Pop70t74C","Pop70t74P","Pop70t74Z","Pop75t79E","Pop75t79M","Pop75t79C","Pop75t79P","Pop75t79Z","Pop80t84E","Pop80t84M","Pop80t84C","Pop80t84P","Pop80t84Z","Pop85plE","Pop85plM","Pop85plC","Pop85plP","Pop85plZ","PopU181E","PopU181M","PopU181C","PopU181P","PopU181Z","Pop65pl1E","Pop65pl1M","Pop65pl1C","Pop65pl1P","Pop65pl1Z","MdAgeE","MdAgeM","MdAgeC","MdAgeP","MdAgeZ","PopU18_2E","PopU18_2M","PopU18_2C","PopU18_2P","PopU18_2Z","PopU18ME","PopU18MM","PopU18MC","PopU18MP","PopU18MZ","PopU18FE","PopU18FM","PopU18FC","PopU18FP","PopU18FZ","Pop65pl2E","Pop65pl2M","Pop65pl2C","Pop65pl2P","Pop65pl2Z","Pop65plME","Pop65plMM","Pop65plMC","Pop65plMP","Pop65plMZ","Pop65plFE","Pop65plFM","Pop65plFC","Pop65plFP","Pop65plFZ","Pop_2E","Pop_2M","Pop_2C","Pop_2P","Pop_2Z","Hsp1E","Hsp1M","Hsp1C","Hsp1P","Hsp1Z","NHspE","NHspM","NHspC","NHspP","NHspZ","WtNHE","WtNHM","WtNHC","WtNHP","WtNHZ","BlNHE","BlNHM","BlNHC","BlNHP","BlNHZ","AIANNHE","AIANNHM","AIANNHC","AIANNHP","AIANNHZ","AsnNHE","AsnNHM","AsnNHC","AsnNHP","AsnNHZ","NHPINHE","NHPINHM","NHPINHC","NHPINHP","NHPINHZ","OthNHE","OthNHM","OthNHC","OthNHP","OthNHZ","Rc2plNHE","Rc2plNHM","Rc2plNHC","Rc2plNHP","Rc2plNHZ","Hsp2E","Hsp2M","Hsp2C","Hsp2P","Hsp2Z","HspMeE","HspMeM","HspMeC","HspMeP","HspMeZ","HspPRE","HspPRM","HspPRC","HspPRP","HspPRZ","HspCubE","HspCubM","HspCubC","HspCubP","HspCubZ","HspDomE","HspDomM","HspDomC","HspDomP","HspDomZ","HspCAmE","HspCAmM","HspCAmC","HspCAmP","HspCAmZ","HspCRE","HspCRM","HspCRC","HspCRP","HspCRZ","HspGuatmE","HspGuatmM","HspGuatmC","HspGuatmP","HspGuatmZ","HspHndE","HspHndM","HspHndC","HspHndP","HspHndZ","HspNicE","HspNicM","HspNicC","HspNicP","HspNicZ","HspPanE","HspPanM","HspPanC","HspPanP","HspPanZ","HspSalvE","HspSalvM","HspSalvC","HspSalvP","HspSalvZ","HspOCAmE","HspOCAmM","HspOCAmC","HspOCAmP","HspOCAmZ","HspSAmE","HspSAmM","HspSAmC","HspSAmP","HspSAmZ","HspArgE","HspArgM","HspArgC","HspArgP","HspArgZ","HspBolE","HspBolM","HspBolC","HspBolP","HspBolZ","HspChlE","HspChlM","HspChlC","HspChlP","HspChlZ","HspColE","HspColM","HspColC","HspColP","HspColZ","HspEcE","HspEcM","HspEcC","HspEcP","HspEcZ","HspPrgE","HspPrgM","HspPrgC","HspPrgP","HspPrgZ","HspPeruE","HspPeruM","HspPeruC","HspPeruP","HspPeruZ","HspUrgE","HspUrgM","HspUrgC","HspUrgP","HspUrgZ","HspVnzE","HspVnzM","HspVnzC","HspVnzP","HspVnzZ","HspOSAmE","HspOSAmM","HspOSAmC","HspOSAmP","HspOSAmZ","HspOthE","HspOthM","HspOthC","HspOthP","HspOthZ","HspSpnrdE","HspSpnrdM","HspSpnrdC","HspSpnrdP","HspSpnrdZ","HspSpnshE","HspSpnshM","HspSpnshC","HspSpnshP","HspSpnshZ","HspSpAmE","HspSpAmM","HspSpAmC","HspSpAmP","HspSpAmZ","HspAllOthE","HspAllOthM","HspAllOthC","HspAllOthP","HspAllOthZ","Asn1RcE","Asn1RcM","Asn1RcC","Asn1RcP","Asn1RcZ","AsnEastE","AsnEastM","AsnEastC","AsnEastP","AsnEastZ","AsnChiNoTE","AsnChiNoTM","AsnChiNoTC","AsnChiNoTP","AsnChiNoTZ","AsnJpnE","AsnJpnM","AsnJpnC","AsnJpnP","AsnJpnZ","AsnKorE","AsnKorM","AsnKorC","AsnKorP","AsnKorZ","AsnMgolE","AsnMgolM","AsnMgolC","AsnMgolP","AsnMgolZ","AsnOkinwE","AsnOkinwM","AsnOkinwC","AsnOkinwP","AsnOkinwZ","AsnTwnE","AsnTwnM","AsnTwnC","AsnTwnP","AsnTwnZ","AsnSouthE","AsnSouthM")
cols2 <- c("AsnSouthC","AsnSouthP","AsnSouthZ","AsnIndE","AsnIndM","AsnIndC","AsnIndP","AsnIndZ","AsnBngE","AsnBngM","AsnBngC","AsnBngP","AsnBngZ","AsnBhutnE","AsnBhutnM","AsnBhutnC","AsnBhutnP","AsnBhutnZ","AsnNepalE","AsnNepalM","AsnNepalC","AsnNepalP","AsnNepalZ","AsnPakE","AsnPakM","AsnPakC","AsnPakP","AsnPakZ","AsnSriLE","AsnSriLM","AsnSriLC","AsnSriLP","AsnSriLZ","AsnSEastE","AsnSEastM","AsnSEastC","AsnSEastP","AsnSEastZ","AsnBurmE","AsnBurmM","AsnBurmC","AsnBurmP","AsnBurmZ","AsnCmbE","AsnCmbM","AsnCmbC","AsnCmbP","AsnCmbZ","AsnFlpE","AsnFlpM","AsnFlpC","AsnFlpP","AsnFlpZ","AsnHmngE","AsnHmngM","AsnHmngC","AsnHmngP","AsnHmngZ","AsnIndnsnE","AsnIndnsnM","AsnIndnsnC","AsnIndnsnP","AsnIndnsnZ","AsnLaoE","AsnLaoM","AsnLaoC","AsnLaoP","AsnLaoZ","AsnMalsnE","AsnMalsnM","AsnMalsnC","AsnMalsnP","AsnMalsnZ","AsnThaiE","AsnThaiM","AsnThaiC","AsnThaiP","AsnThaiZ","AsnVtnE","AsnVtnM","AsnVtnC","AsnVtnP","AsnVtnZ","AsnOAsnE","AsnOAsnM","AsnOAsnC","AsnOAsnP","AsnOAsnZ","Asn2plE","Asn2plM","Asn2plC","Asn2plP","Asn2plZ",
           "GeoType","GeogName","GeoID")
cols3 <- c("PopE","PopM","PopC","PopP","PopZ","MPop0t5E","MPop0t5M","MPop0t5C","MPop0t5P","MPop0t5Z","MPop5t9E","MPop5t9M","MPop5t9C","MPop5t9P","MPop5t9Z","MPop10t14E","MPop10t14M","MPop10t14C","MPop10t14P","MPop10t14Z","MPop15t19E","MPop15t19M","MPop15t19C","MPop15t19P","MPop15t19Z","MPop20t24E","MPop20t24M","MPop20t24C","MPop20t24P","MPop20t24Z","MPop25t29E","MPop25t29M","MPop25t29C","MPop25t29P","MPop25t29Z","MPop30t34E","MPop30t34M","MPop30t34C","MPop30t34P","MPop30t34Z","MPop35t39E","MPop35t39M","MPop35t39C","MPop35t39P","MPop35t39Z","MPop40t44E","MPop40t44M","MPop40t44C","MPop40t44P","MPop40t44Z","MPop45t49E","MPop45t49M","MPop45t49C","MPop45t49P","MPop45t49Z","MPop50t54E","MPop50t54M","MPop50t54C","MPop50t54P","MPop50t54Z","MPop55t59E","MPop55t59M","MPop55t59C","MPop55t59P","MPop55t59Z","MPop60t64E","MPop60t64M","MPop60t64C","MPop60t64P","MPop60t64Z","MPop65t69E","MPop65t69M","MPop65t69C","MPop65t69P","MPop65t69Z","MPop70t74E","MPop70t74M","MPop70t74C","MPop70t74P","MPop70t74Z","MPop75t79E","MPop75t79M","MPop75t79C","MPop75t79P","MPop75t79Z","MPop80t84E","MPop80t84M","MPop80t84C","MPop80t84P","MPop80t84Z","MPop85plE","MPop85plM","MPop85plC","MPop85plP","MPop85plZ","FPop0t5E","FPop0t5M","FPop0t5C","FPop0t5P","FPop0t5Z","FPop5t9E","FPop5t9M","FPop5t9C","FPop5t9P","FPop5t9Z","FPop10t14E","FPop10t14M","FPop10t14C","FPop10t14P","FPop10t14Z","FPop15t19E","FPop15t19M","FPop15t19C","FPop15t19P","FPop15t19Z","FPop20t24E","FPop20t24M","FPop20t24C","FPop20t24P","FPop20t24Z","FPop25t29E","FPop25t29M","FPop25t29C","FPop25t29P","FPop25t29Z","FPop30t34E","FPop30t34M","FPop30t34C","FPop30t34P","FPop30t34Z","FPop35t39E","FPop35t39M","FPop35t39C","FPop35t39P","FPop35t39Z","FPop40t44E","FPop40t44M","FPop40t44C","FPop40t44P","FPop40t44Z","FPop45t49E","FPop45t49M","FPop45t49C","FPop45t49P","FPop45t49Z","FPop50t54E","FPop50t54M","FPop50t54C","FPop50t54P","FPop50t54Z","FPop55t59E","FPop55t59M","FPop55t59C","FPop55t59P","FPop55t59Z","FPop60t64E","FPop60t64M","FPop60t64C","FPop60t64P","FPop60t64Z","FPop65t69E","FPop65t69M","FPop65t69C","FPop65t69P","FPop65t69Z","FPop70t74E","FPop70t74M","FPop70t74C","FPop70t74P","FPop70t74Z","FPop75t79E","FPop75t79M","FPop75t79C","FPop75t79P","FPop75t79Z","FPop80t84E","FPop80t84M","FPop80t84C","FPop80t84P","FPop80t84Z","FPop85plE","FPop85plM","FPop85plC","FPop85plP","FPop85plZ")
cols_all <- c(cols1, cols2, cols3)
df <- Demographic1115_1
melted <- melt(df, id.var=c("GeoType","GeogName","GeoID"))
split <- melted %>% separate(variable, into = c("variable", "type"), sep = -2)
casted <- dcast(split, GeoType + GeogName + GeoID + variable ~ type)
write.csv(casted, 'melted.csv', na="", row.names = FALSE)
